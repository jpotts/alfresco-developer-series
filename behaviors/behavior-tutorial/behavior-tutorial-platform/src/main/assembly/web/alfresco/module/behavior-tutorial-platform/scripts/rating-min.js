function computeAverage(f){var c=f.parent;if(!c.hasAspect("{http://www.someco.com/model/ratings/1.0}rateable")){logger.log("Rating's parent ref did not have rateable aspect.");return}var a=c.children;var e=0;var d=0;if(a!=null&&a.length>0){for(i in a){var g=a[i];var b=g.properties["{http://www.someco.com/model/ratings/1.0}rating"];d+=b}e=d/a.length}logger.log("Computed average:"+e);c.properties["{http://www.someco.com/model/ratings/1.0}averageRating"]=e;c.properties["{http://www.someco.com/model/ratings/1.0}totalRating"]=d;c.properties["{http://www.someco.com/model/ratings/1.0}ratingCount"]=a.length;c.save();logger.log("Property set")}function getUserRating(d,a){if(a==undefined||a==""){logger.log("User name was not passed in");return 0}var b=d.childrenByXPath("*//.[@scr:rater='"+a+"']");if(b==undefined||b.length==0){logger.log("No ratings found for this node for user: "+a);return 0}else{var c=b[b.length-1].properties["{http://www.someco.com/model/ratings/1.0}rating"];if(c==undefined){return 0}else{return c}}}function getRating(c,a){var b={};b.average=c.properties["{http://www.someco.com/model/ratings/1.0}averageRating"];b.count=c.properties["{http://www.someco.com/model/ratings/1.0}ratingCount"];b.user=getUserRating(c,a);return b}function deleteRatings(b){if(!b.hasAspect("{http://www.someco.com/model/ratings/1.0}rateable")){logger.log("Node did not have rateable aspect.");return}var a=b.children;if(a!=null&&a.length>0){logger.log("Found children...iterating");for(i in a){var c=a[i];logger.log("Removing child: "+c.id);c.remove()}}};